# Metrics Catalog

This document provides a comprehensive inventory of team and player warehouse metrics, projection and value metrics, boom/exceedance calculations, and diagnostic measures used throughout the NFL GPP Simulator.

## Overview

The metrics catalog serves as the definitive reference for all quantitative measures computed from nfl_data_py historical data (2023-2024) and generated by the Monte Carlo simulator. These metrics feed into priors, inform simulation distributions, and provide the foundation for value and boom calculations.

## Team Warehouse Metrics

### Team-Level Features (from nfl_data_py)

**Pace and Volume Metrics:**
```
pace_mean                 # Plays per game (offense)
pace_std                  # Standard deviation of plays per game
seconds_per_play_mean     # Average time between plays
seconds_per_play_std      # Pace variability
```

**Passing Tendency:**
```
neutral_xpass            # Expected pass rate in neutral situations
proe_neutral             # Pass Rate Over Expected in neutral game script
actual_pass_rate_mean    # Overall pass rate including all game scripts
pass_rate_std            # Variability in game-to-game pass rate
```

**Efficiency Metrics:**
```
epa_per_play_offense     # Expected Points Added per offensive play
epa_per_play_defense     # EPA allowed per defensive play
success_rate_offense     # Percentage of successful plays (offense)
success_rate_defense     # Percentage of successful plays allowed (defense)
```

**Scoring and Field Position:**
```
points_per_game_mean     # Average points scored
points_per_game_std      # Scoring volatility
red_zone_efficiency      # TD rate inside opponent 20-yard line
turnover_rate_offense    # Turnovers per drive
turnover_rate_defense    # Turnovers forced per opponent drive
```

**Game Script Indicators:**
```
avg_score_differential   # Average point differential (positive = winning)
blowout_frequency        # Games with 14+ point margin
close_game_frequency     # Games decided by 7 or fewer points
garbage_time_snaps       # Snaps in garbage time situations
```

### Team Priors Output Format

**File:** `data/baseline/team_priors.csv`
```
team,pace_mean,pace_std,neutral_xpass,proe_neutral,epa_per_play_off,epa_per_play_def,success_rate_off,success_rate_def,points_per_game_mean,points_per_game_std,red_zone_efficiency,turnover_rate_off,turnover_rate_def
BUF,65.2,4.1,0.58,0.03,0.12,-0.05,0.46,0.42,28.5,6.8,0.62,0.11,0.13
KC,63.8,3.9,0.61,-0.01,0.15,-0.08,0.48,0.40,29.2,5.4,0.65,0.09,0.15
```

## Player Warehouse Metrics

### Quarterback Metrics

**Volume and Usage:**
```
dropbacks_per_game       # Average dropback attempts
completion_percentage    # Completions / attempts
deep_ball_rate          # Passes 20+ yards downfield / attempts
red_zone_attempts       # Dropbacks inside opponent 20
```

**Efficiency Measures:**
```
yards_per_attempt       # Passing yards / attempt
yards_per_completion    # Passing yards / completion
td_rate                # Passing TDs / attempt
int_rate               # Interceptions / attempt
sack_rate              # Sacks / dropback
```

**Advanced Metrics:**
```
epa_per_dropback       # Expected Points Added per dropback
cpoe_mean             # Completion Percentage Over Expected
air_yards_per_attempt  # Average air yards per attempt
yac_per_completion    # Yards After Catch per completion
qbr_mean              # Average QBR when available
```

**Situational Splits:**
```
neutral_script_epa     # EPA in neutral game script
behind_script_epa      # EPA when trailing by 7+
ahead_script_epa       # EPA when leading by 7+
third_down_conversion  # 3rd down conversion rate
```

### Running Back Metrics

**Volume and Opportunity:**
```
carries_per_game       # Rushing attempts per game
targets_per_game       # Receiving targets per game
snap_share            # Offensive snaps played / team total
red_zone_carries      # Carries inside opponent 20
goal_line_carries     # Carries inside opponent 5
```

**Efficiency Measures:**
```
yards_per_carry       # Rushing yards / attempt
yards_per_target      # Receiving yards / target
catch_rate           # Receptions / targets
td_rate_rushing      # Rushing TDs / carry
td_rate_receiving    # Receiving TDs / target
```

**Advanced Metrics:**
```
yards_after_contact   # YAC on rushing attempts
missed_tackles_forced # Broken tackles per touch
epa_per_carry        # Expected Points Added per carry
epa_per_target       # EPA per receiving target
wopr                 # Weighted Opportunity Rating (targets + 2.5*RZ targets)
```

**Usage Context:**
```
early_down_share     # Carries on 1st/2nd down / team total
passing_down_targets # Targets on 3rd/4th down and 2-minute drill
high_value_touches   # RZ carries + targets inside 10
backfield_share      # Touches / total RB touches for team
```

### Wide Receiver Metrics

**Volume and Opportunity:**
```
targets_per_game     # Receiving targets per game
snap_share          # Offensive snaps / team total
slot_rate           # Snaps in slot / total snaps
red_zone_targets    # Targets inside opponent 20
air_yards_share     # Team air yards targeted to player
```

**Efficiency Measures:**
```
catch_rate          # Receptions / targets
yards_per_target    # Receiving yards / target
yards_per_reception # Receiving yards / reception
td_rate            # Receiving TDs / target
first_down_rate    # First downs / reception
```

**Advanced Metrics:**
```
wopr               # Weighted Opportunity Rating
racr               # Receiver Air Conversion Ratio (rec yards / air yards)
xyac_mean_yardage  # Expected YAC per reception
yac_over_expected  # Actual YAC - Expected YAC
adot               # Average Depth of Target
```

**Route and Coverage:**
```
target_share       # Targets / team targets
end_zone_targets   # Targets in end zone
contested_catch_rate # Catches in traffic / contested targets
separation_average  # Average separation at catch point
```

### Tight End Metrics

**Usage Profile:**
```
targets_per_game    # Receiving targets per game
blocking_snaps     # Snaps spent in blocking role
route_participation # Routes run / pass attempts
red_zone_usage     # RZ targets + RZ routes
```

**Receiving Efficiency:**
```
catch_rate         # Receptions / targets
yards_per_target   # Receiving yards / target
td_rate           # Receiving TDs / target
yac_per_reception # YAC / reception
```

**Advanced Metrics:**
```
wopr              # Weighted Opportunity Rating
target_quality    # Average air yards per target
role_versatility  # Slot rate + wide rate + inline rate
mismatch_rate     # Targets vs LBs and safeties
```

### Defense/DST Metrics

**Team Defense Performance:**
```
sacks_per_game           # Sacks per game
interceptions_per_game   # INTs per game
fumbles_recovered_per_game # Fumble recoveries per game
points_allowed_per_game  # Points allowed per game
total_yards_allowed     # Yards allowed per game
```

**Positional Matchups:**
```
qb_pressure_rate        # QB pressures / opponent dropbacks
pass_defense_vs_wr      # EPA allowed to WRs
pass_defense_vs_te      # EPA allowed to TEs
run_defense_vs_rb       # EPA allowed to RBs
red_zone_defense        # TDs allowed / RZ attempts
```

**Turnover Generation:**
```
turnover_rate           # Turnovers forced / opponent drives
int_rate_defense        # INTs / opponent attempts
fumble_force_rate       # Fumbles forced / opponent touches
defensive_td_rate       # Defensive/special teams TDs
```

## Projection and Value Metrics

### Monte Carlo Derived Metrics

**Core Projections** (from simulation):
```
sim_mean               # Expected DK points from Monte Carlo
floor_p10             # 10th percentile (floor estimate)
p75                   # 75th percentile
ceiling_p90           # 90th percentile (ceiling estimate)
p95                   # 95th percentile (spike week potential)
sim_std               # Standard deviation of projections
```

**Value Calculations:**
```
value_per_1k          # sim_mean / (salary / 1000)
ceil_per_1k           # ceiling_p90 / (salary / 1000)
value_vs_position     # Value percentile within position
salary_efficiency     # Value relative to salary tier
```

**Site Comparison** (when site FPTS available):
```
delta_mean            # sim_mean - site_fpts
pct_delta             # delta_mean / |site_fpts|
beat_site_prob        # P(sim_result >= site_fpts)
site_vs_sim_ratio     # site_fpts / sim_mean
```

### Boom and Exceedance Metrics

**Boom Thresholds:**
```
pos_boom              # Position-level p90 from 2023-2024 baseline
site_boost            # max(1.20 × site_fpts, site_fpts + 5)
boom_cut              # max(pos_boom, site_boost)
```

**Boom Calculations:**
```
boom_prob             # P(sim_result >= boom_cut)
boom_score_raw        # 0.6 × boom_prob + 0.4 × beat_site_prob
boom_score            # Position-normalized percentile with boosts
dart_flag             # (RST% ≤ 5) AND (boom_score ≥ 70)
```

**Ownership and Value Boosts:**
```
ownership_boost       # +20% if RST% ≤ 5; +10% if ≤ 10; +5% if ≤ 20
value_boost          # Up to +15% if value_per_1k > position median
final_boom_score     # boom_score_raw × (1 + own_boost) × (1 + value_boost)
```

## Diagnostic Metrics

### Accuracy Measures

**Error Metrics** (sim vs site when available):
```
mae                   # Mean Absolute Error
rmse                  # Root Mean Square Error
correlation           # Pearson correlation coefficient
rank_correlation      # Spearman rank correlation
```

**Coverage Statistics:**
```
coverage_p10_p90      # % where site_fpts in [p10, p90]
coverage_p25_p75      # % where site_fpts in [p25, p75]
under_projection      # % where sim_mean < site_fpts
over_projection       # % where sim_mean > site_fpts
```

**Position-Level Diagnostics:**
```
position_mae          # MAE by position
position_bias         # Average delta by position
position_coverage     # Coverage rates by position
sample_size_by_pos    # Player counts by position
```

### Quality Control Flags

**Data Quality Issues:**
```
missing_salary        # Players without salary data
missing_ownership     # Players without RST% data
unknown_position      # Positions not in {QB,RB,WR,TE,DST}
extreme_projections   # Projections outside reasonable bounds
```

**Simulation Diagnostics:**
```
negative_draws        # Simulation draws < 0 (before clamping)
convergence_check     # Monte Carlo standard error estimates
seed_determinism      # Reproducibility verification
runtime_performance   # Simulation time per player
```

**Outlier Detection:**
```
large_absolute_delta  # |delta_mean| > threshold
large_percent_delta   # |pct_delta| > threshold
boom_score_outliers   # boom_score in [0, 5] or [95, 100]
value_outliers        # value_per_1k > 2 standard deviations
```

## Output File Schemas

### sim_players.csv
```
player_id,PLAYER,POS,TEAM,OPP,sim_mean,floor_p10,p75,ceiling_p90,p95,boom_prob,rookie_fallback,SAL
```

### compare.csv
```
player_id,PLAYER,POS,TEAM,OPP,sim_mean,site_fpts,delta_mean,pct_delta,beat_site_prob,value_per_1k,ceil_per_1k,site_val,RST%,boom_score,dart_flag,SAL
```

### diagnostics_summary.csv
```
position,count,count_rookies,mae,rmse,correlation,coverage_p10_p90,coverage_p25_p75,mean_delta,bias_direction
```

### flags.csv
```
player_id,PLAYER,POS,flag_type,flag_value,description,severity
```

## Computational Notes

### Performance Considerations
- Team metrics: Computed once per baseline build
- Player metrics: Cached by player_id and season
- Monte Carlo: Vectorized operations for 10k+ simulations
- Diagnostics: Computed incrementally during simulation

### Memory Usage
- Full week simulation: ~50MB for 150 players × 10k sims
- Historical baseline: ~100MB for 2-season warehouse
- Cached metrics: ~10MB persistent storage per season

### Accuracy vs Speed Tradeoffs
- 1k simulations: Fast (~5 seconds), moderate accuracy
- 10k simulations: Standard (~30 seconds), good accuracy
- 100k simulations: Slow (~5 minutes), high accuracy
- Recommendation: 10k for production, 1k for development

## Integration Points

### Baseline Scripts
```python
# Team metrics computation
from src.metrics.team_metrics import compute_team_priors
team_priors = compute_team_priors(seasons=[2023, 2024])

# Player metrics computation  
from src.metrics.player_metrics import compute_player_priors
player_priors = compute_player_priors(seasons=[2023, 2024])
```

### Simulator Engine
```python
# Value metrics calculation
from src.projections.value_metrics import calculate_value_metrics
value_metrics = calculate_value_metrics(sim_results, salaries)

# Boom score computation
from src.projections.boom_score import calculate_boom_scores
boom_scores = calculate_boom_scores(sim_results, boom_thresholds, ownership)
```

### UI Integration
```python
# Streamlit filtering by metrics
filtered_df = compare_df[
    (compare_df['boom_score'] >= min_boom) &
    (compare_df['value_per_1k'] >= min_value) &
    (compare_df['POS'].isin(selected_positions))
]
```

This metrics catalog provides the foundation for all quantitative analysis in the NFL GPP Simulator, ensuring consistent definitions and calculations across the entire system.